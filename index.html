<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Figure Workouts</title>
    <!-- Preload main images for LCP -->
    <link rel="preload" as="image" fetchpriority="high" href="img/background-first-slide.png">
    <link rel="preload" as="image" fetchpriority="high" href="img/women.webp">
    <!-- Preload critical fonts to improve TBT and LCP-->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700&display=swap" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Encode+Sans+Condensed:wght@600;900&display=swap" as="style">
    <!-- Load fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Encode+Sans+Condensed:wght@600;900&display=swap">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container first-slide">
        <!-- Slide 1 -->
        <div class="slide active" data-slide="1">
            <div class="row">
                <div class="content-left">
                    <h1>Achieve Your Dream Figure with Quick and Effective Workouts.</h1>
                    <p class="subtitle slide-1">Take this 30-second quiz to find out how</p>
                    <div class="buttons-container">
                        <button class="btn" data-gender="female">
                            <span>♀</span> Women Start Here
                        </button>
                        <button class="btn" data-gender="male">
                            <span>♂</span> Men Start Here
                        </button>
                    </div>
                </div>
            </div>

            <div class="logos">
                <div class="grid-container">
                    <div class="grid-item">
                        <img src="img/womenshealth.webp" fetchpriority="low" data-safariimage="img/womenshealth.png" alt="Women's Health" loading="lazy">
                    </div>
                    <div class="grid-item">
                        <img src="img/forbes.webp" fetchpriority="low" data-safariimage="img/forbes.png" alt="Forbes" loading="lazy">
                    </div>
                    <div class="grid-item">
                        <img src="img/mayoclinic.webp" fetchpriority="low" data-safariimage="img/mayoclinic.png" alt="Mayo Clinic" loading="lazy">
                    </div>
                    <div class="grid-item">
                        <img src="img/The-Wall-Street-Journal-Logo-2 1.webp" fetchpriority="low" data-safariimage="img/The-Wall-Street-Journal-Logo-2 1.png" alt="Wall Street Journal" loading="lazy">
                    </div>
                    <div class="grid-item">
                        <img src="img/vogue.webp" fetchpriority="low" data-safariimage="img/vogue.png" alt="Vogue" loading="lazy">
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 2 -->
        <div class="slide" data-slide="2">
            <div class="quiz-container">
                <h2>Achieve Your Dream Figure with Quick and Effective Workouts.</h2>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <div class="question-container">
                    <h3>Do you think hours of cardio is beneficial for fat loss?</h3>
                    <p class="subtitle">(Many people think doing cardio every day is the answer.)</p>
                    
                    <div class="options-container">
                        <label class="option-btn">
                            <input type="radio" name="cardio" value="yes">
                            <span class="radio-custom"></span>
                            <span class="option-text">Yes</span>
                        </label>
                        <label class="option-btn active">
                            <input type="radio" name="cardio" value="no" checked>
                            <span class="radio-custom"></span>
                            <span class="option-text">No</span>
                        </label>
                        <label class="option-btn">
                            <input type="radio" name="cardio" value="not-sure">
                            <span class="radio-custom"></span>
                            <span class="option-text">Not Sure</span>
                        </label>
                    </div>
                </div>
                <div class="navigation">
                    <button class="nav-btn prev slide2-prev">‹</button>
                    <span class="page-number">2/5</span>
                    <button class="nav-btn next slide2-next">›</button>
                </div>
            </div>
        </div>
        <!-- Slide 3 -->
        <div class="slide" data-slide="3">
            <div class="quiz-container">
                <h2>Achieve Your Dream Figure with Quick and Effective Workouts.</h2>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <div class="question-container">
                    <h3>If there was a 7-minute routine to get you fit, would you want to add it to your daily routine?</h3>
                    <p class="subtitle">(Certain exercise routines can help ignite your metabolism for faster fat burn)</p>
                    
                    <div class="options-container">
                        <label class="option-btn">
                            <input type="radio" name="routine" value="definitely">
                            <span class="radio-custom"></span>
                            <span class="option-text">Definitely</span>
                        </label>
                        <label class="option-btn">
                            <input type="radio" name="routine" value="maybe">
                            <span class="radio-custom"></span>
                            <span class="option-text">Maybe</span>
                        </label>
                        <label class="option-btn">
                            <input type="radio" name="routine" value="not-sure">
                            <span class="radio-custom"></span>
                            <span class="option-text">Not Sure</span>
                        </label>
                    </div>
                </div>
                <div class="navigation">
                    <button class="nav-btn prev slide3-prev">‹</button>
                    <span class="page-number">3/5</span>
                    <button class="nav-btn next slide3-next">›</button>
                </div>
            </div>
        </div>
        <!-- Slide 4 - Loading Animation Slide -->
        <div class="slide" data-slide="4">
            <div class="loading-container">
                <!-- Left content with heading and loading text -->
                <div class="loading-content">
                    <div class="loading-text-content">
                        <h2>Achieve Your Dream Figure with Quick and Effective Workouts.</h2>
                        <p class="loading-text">Please wait while we match you with the best routine for maximum fat loss...</p>
                    </div>
                    
                    <!-- Circular Progress Container -->
                    <div class="circular-progress">
                        <div class="progress-ring">
                            <svg width="200" height="200" viewBox="0 0 200 200">
                                <circle class="progress-ring__circle-bg" r="90" cx="100" cy="100" />
                                <circle class="progress-ring__circle-progress" r="90" cx="100" cy="100" />
                            </svg>
                            <div class="progress-text">
                                <div class="progress-number">
                                    <span class="progress-percentage">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right content with image -->
                <div class="loading-image">
                    <img src="img/woman-sitting.webp" fetchpriority="low" data-safariimage="img/woman-sitting.png" alt="Fitness Woman" loading="lazy">
                </div>
            </div>
        </div>
    </div>

    <script>
        
        // fallback png images for Safari old versions where webp is not supported
        document.addEventListener('DOMContentLoaded', function () {
            if (!support_format_webp()) {
              document.querySelectorAll('img[data-safariimage]').forEach(function (img) {
                var safariImage = img.getAttribute('data-safariimage');
                img.setAttribute('src', safariImage);
                img.setAttribute('data-src', safariImage);
                var firstSlide = document.querySelector('.first-slide');
                if (firstSlide) {
                    firstSlide.classList.add('png');
                }
              });
            }
        });
        // Store quiz state
        const quizState = {
            currentSlide: 1,
            gender: null,
            answers: {}
        };

        // Handle gender selection and slide transition
        document.querySelectorAll('.btn[data-gender]').forEach(button => {
            button.addEventListener('click', function() {
                quizState.gender = this.dataset.gender;
                const container = document.querySelector('.container');
                container.classList.remove('first-slide');
                showSlide(2);
                // Animate progress to 15%
                animateProgress(2, 0, 15);
            });
        });

        // Function to animate progress bar with proper reset
        function animateProgress(slideNumber, start, end) {
            const slide = document.querySelector(`.slide[data-slide="${slideNumber}"]`);
            if (!slide) return;

            if (slideNumber === 4) {
                // Circular progress animation for slide 4
                let currentProgress = start;
                const animate = async () => {
                    // First phase: 0% to 43%
                    while (currentProgress <= 43) {
                        setCircularProgress(currentProgress);
                        await new Promise(resolve => setTimeout(resolve, 50));
                        currentProgress++;
                    }
                    
                    // Pause at 43%
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Second phase: 43% to 67%
                    while (currentProgress <= 67) {
                        setCircularProgress(currentProgress);
                        await new Promise(resolve => setTimeout(resolve, 50));
                        currentProgress++;
                    }
                };
                animate();
            } else {
                // Original linear progress bar animation for other slides
                const progressBar = slide.querySelector('.progress');
                if (!progressBar) return;

                progressBar.style.transition = 'none';
                progressBar.style.width = start + '%';
                progressBar.offsetHeight; // Force reflow

                progressBar.style.transition = 'width 0.8s ease-in-out';
                requestAnimationFrame(() => {
                    progressBar.style.width = end + '%';
                });
            }
        }

        // Function to set circular progress
        function setCircularProgress(percent) {
            const circle = document.querySelector('.progress-ring__circle-progress');
            const percentText = document.querySelector('.progress-percentage');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            
            const offset = circumference - (percent / 100 * circumference);
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
            
            percentText.textContent = Math.round(percent);
        }

        // Handle slide 2 option selection
        document.querySelectorAll('[name="cardio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Remove active class from all options in this slide
                this.closest('.slide').querySelectorAll('.option-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                // Add active class to selected option
                this.closest('.option-btn').classList.add('active');
                
                // Store answer
                quizState.answers.cardio = this.value;
                
                // Transition to slide 3 after delay
                setTimeout(() => {
                    showSlide(3);
                    animateProgress(3, 15, 40);
                }, 800);
            });
        });

        // Handle slide 3 option selection
        document.querySelectorAll('[name="routine"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Remove active class from all options in this slide
                this.closest('.slide').querySelectorAll('.option-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                // Add active class to selected option
                this.closest('.option-btn').classList.add('active');
                
                // Store answer
                quizState.answers.routine = this.value;
                
                // Transition to slide 4 after delay
                setTimeout(() => {
                    showSlide(4);
                    animateProgress(4, 0, 67); // Start circular progress animation
                }, 800);
            });
        });

        // Handle navigation with fixed animations
        document.querySelector('.nav-btn.prev.slide2-prev')?.addEventListener('click', () => {
            if (quizState.currentSlide > 1) {
                // Handle transition from slide 3 to 2
                if (quizState.currentSlide === 3) {
                    showSlide(2);
                    animateProgress(2, 40, 15);
                }
                // Handle transition from slide 2 to 1
                else if (quizState.currentSlide === 2) {
                    const container = document.querySelector('.container');
                    container.classList.remove('second-slide');
                    container.classList.add('first-slide');
                    showSlide(1);
                    animateProgress(2, 15, 0);
                }
            }
        });

        document.querySelector('.nav-btn.next.slide2-next')?.addEventListener('click', () => {
            if (quizState.currentSlide < 5) {
                // Handle transition from slide 2 to 3
                if (quizState.currentSlide === 2) {
                    showSlide(3);
                    animateProgress(3, 15, 40);
                }
                // Handle other transitions
                else {
                    showSlide(quizState.currentSlide + 1);
                }
            }
        });

        document.querySelector('.nav-btn.prev.slide3-prev')?.addEventListener('click', () => {
            if (quizState.currentSlide > 1) {
                // Handle transition from slide 3 to 2
                if (quizState.currentSlide === 3) {
                    showSlide(2);
                    animateProgress(2, 40, 15);
                }
                // Handle transition from slide 2 to 1
                else if (quizState.currentSlide === 2) {
                    const container = document.querySelector('.container');
                    container.classList.remove('second-slide');
                    container.classList.add('first-slide');
                    showSlide(1);
                    animateProgress(2, 15, 0);
                }
            }
        });

        document.querySelector('.nav-btn.next.slide3-next')?.addEventListener('click', () => {
            if (quizState.currentSlide < 5) {
                // Handle transition from slide 2 to 3
                if (quizState.currentSlide === 2) {
                    showSlide(3);
                    animateProgress(3, 15, 40);
                }
                // Handle other transitions
                else {
                    showSlide(4);
                    animateProgress(4, 0, 67);
                }
            }
        });

        // Function to show slide with proper transitions
        function showSlide(slideNumber) {
            const slides = document.querySelectorAll('.slide');
            const currentSlide = document.querySelector('.slide.active');
            const targetSlide = document.querySelector(`.slide[data-slide="${slideNumber}"]`);
            
            if (!targetSlide) return;

            // First, mark all slides as inactive but don't hide them yet
            slides.forEach(slide => {
                if (slide !== targetSlide && slide !== currentSlide) {
                    slide.style.visibility = 'hidden';
                    slide.style.display = 'none';
                    slide.classList.remove('active');
                }
            });

            // Show the target slide (but keep it invisible)
            targetSlide.style.visibility = 'hidden';
            targetSlide.style.display = 'block';
            targetSlide.offsetHeight; // Force reflow

            // If there's a current slide, fade it out
            if (currentSlide) {
                currentSlide.classList.remove('active');
                setTimeout(() => {
                    currentSlide.style.visibility = 'hidden';
                    currentSlide.style.display = 'none';
                }, 100); // Match this with your CSS transition time
            }

            // Fade in the target slide
            requestAnimationFrame(() => {
                targetSlide.style.visibility = 'visible';
                targetSlide.classList.add('active');
            });
            
            quizState.currentSlide = slideNumber;
        }
        function support_format_webp()
        {
        // Detect Safari and check the version
        var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        if (isSafari) {
        var safariVersion = navigator.userAgent.match(/Version\/(\d+)/);
        var macOsVersion = navigator.userAgent.match(/Mac OS X (\d+)_(\d+)_?(\d+)?/);
        var iOSVersion = navigator.userAgent.match(/OS (\d+)_?(\d+)?/);

        // Check for Safari version 14+
        if (safariVersion && parseInt(safariVersion[1], 10) >= 14) {
        // If macOS, check for Big Sur (11) or later
        if (macOsVersion) {
        var macMajor = parseInt(macOsVersion[1], 10);
        var macMinor = parseInt(macOsVersion[2], 10);

        // macOS Big Sur (11) or later supports WebP with Safari 14+
        if (macMajor > 10 || (macMajor === 10 && macMinor >= 16)) {
        return true;
        }
        }
        // If iOS, check for iOS 14 or later
        else if (iOSVersion) {
        var iOSMajor = parseInt(iOSVersion[1], 10);

        // iOS 14 or later supports WebP with Safari 14+
        if (iOSMajor >= 14) {
        return true;
        }
        }
        }
        }

        // For non-Safari or Safari versions below 14, use the canvas method to check WebP support
        var elem = document.createElement('canvas');
        if (!!(elem.getContext && elem.getContext('2d'))) {
        // Check if WebP is supported by testing the canvas toDataURL with WebP
        return elem.toDataURL('image/webp').indexOf('data:image/webp') === 0;
        } else {
        // If canvas is not supported (very old browsers), return false
        return false;
        }
        }
    </script>
</body>
</html>
